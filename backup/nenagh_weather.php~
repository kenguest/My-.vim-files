<?php
/**
 * nenagh_weather.php
 * 04-Mar-2010
 *
 * PHP Version 5
 *
 * @category nenagh_weather
 * @package  nenagh_weather
 * @author   Ken Guest <ken.guest@blacknight.com>
 * @license  GPL (see http://www.gnu.org/licenses/gpl.txt)
 * @version  CVS: <cvs_id>
 * @link     nenagh_weather.php
 * @todo
 */

require_once 'HTTP/Request2.php';
$url = 'http://www.nra.ie/RoadWeatherInfo/Map/data/htm/WeatherTable.htm';
$request = new HTTP_Request2($url, HTTP_Request2::METHOD_GET);
$request->setHeader("User-Agent", "Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.0.14) Gecko/2009090216 Ubuntu/8.10 (intrepid) Firefox/3.0. 14)");
$response = $request->send();
var_dump ($response);
$tidy = new tidy;
$config = array(
        'indent'         => true,
        'output-xhtml'   => true,
        'wrap'           => 200);
$tidy->parseString($response->getBody(), $config);
$tidy->cleanRepair();
$html = $tidy;
$html = str_replace('&nbsp;', ' ', $html);
$html = str_replace('&nbsp', ' ', $html);
$html = str_replace('&amp;nbsp', ' ', $html);

$dom = new domDocument;

$dom->loadHTML($html);
$dom->preserveWhiteSpace = false;
$tables = $dom->getElementsByTagName('table');
$rows = $tables->item(0)->getElementsByTagName('tr');
foreach ($rows as $row)
{
    $cols = $row->getElementsByTagName('td');
    if (strpos($cols->item(0)->nodeValue, 'Nenagh')) {
        $msg = trim($cols->item(0)->nodeValue)." ". trim($cols->item(1)->nodeValue)." ". trim($cols->item(2)->nodeValue)." ". trim($cols->item(6)->nodeValue);
        system('notify-send -u normal -t 2500 -i info "Road Weather Info" "'.$msg.'"');
    }
}
?>
